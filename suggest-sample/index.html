<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
 "http://www.w3.org/TR/html4/loose.dtd">
<html>

	<head>
		<title>デモンストレーション</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

		<link rel="stylesheet" href="css/ui-lightness/jquery-ui-1.10.3.custom.css" type="text/css">
    <!--
    テキストボックスのStyle設定
    -->
    <style>
    .textbox {
      background: white;
      border: 1px solid #DDD;
      border-radius: 5px;
      box-shadow: 0 0 5px #DDD inset;
      color: #666;
      outline: none;
      height:25px;
      width: 275px;
    }
    </style>

    <!--
    ボタンのStyle設定
    -->
    <style type="text/css">
    .css_btn_class {
      font-size:12px;
      font-family:Arial;
      font-weight:normal;
      -moz-border-radius:8px;
      -webkit-border-radius:8px;
      border-radius:8px;
      border:1px solid #3866a3;
      padding:5px 18px;
      text-decoration:none;
      background:-webkit-gradient( linear, left top, left bottom, color-stop(5%, #63b8ee), color-stop(100%, #468ccf) );
      background:-moz-linear-gradient( center top, #63b8ee 5%, #468ccf 100% );
      background:-ms-linear-gradient( top, #63b8ee 5%, #468ccf 100% );
      filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#63b8ee', endColorstr='#468ccf');
      background-color:#63b8ee;
      color:#ffffff;
      display:inline-block;
      text-shadow:1px 1px 0px #7cacde;
      -webkit-box-shadow:inset 1px 1px 0px 0px #bee2f9;
      -moz-box-shadow:inset 1px 1px 0px 0px #bee2f9;
      box-shadow:inset 1px 1px 0px 0px #bee2f9;
    }.css_btn_class:hover {
      background:-webkit-gradient( linear, left top, left bottom, color-stop(5%, #468ccf), color-stop(100%, #63b8ee) );
      background:-moz-linear-gradient( center top, #468ccf 5%, #63b8ee 100% );
      background:-ms-linear-gradient( top, #468ccf 5%, #63b8ee 100% );
      filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#468ccf', endColorstr='#63b8ee');
      background-color:#468ccf;
    }.css_btn_class:active {
      position:relative;
      top:1px;
    }
    /* This css button was generated by http://html-generator.weebly.com */
    </style>

		<script type="text/javascript" src="js/jquery-1.9.1.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.10.3.custom.js"></script>
    <script language="JavaScript"><!--
    var collection = "collection1";
    var field = "name";

    var keyDownCode = 0;

		/*
		 * TermsComponentを使ったAutoComplete
		 */
		$(function(){
			$("#terms").autocomplete({
				search: function(event, ui){
					//if (event.keyCode == 229) return false;
					return true;
				},
				select: function (e, ui) {
					$("#terms").val(ui.item.label);
					return false;
				},
				source: function(request, response){
					$.ajax({
						url: "/solr/" + collection + "/terms",
						type: "GET",
						cache: false,
						dataType: "json",
						data: {'terms.fl':field, 'terms.lower':request.term, 'terms.prefix':request.term, wt:'json'},
						success: function(o){
							var values = new Array();
							//for(var i = 0; i < o.terms.station_name_e.length; i++){
              for(var i = 0; i < o.terms[field].length; i++){
                  if(i % 2 == 0) {
									values.push(o.terms.station_name_e[i])
								}
							}
							response(values);
						},
						error: function(xhr, ts, err){
							response();
						}
					});
				},
				open: function() {
					$(this).removeClass("ui-corner-all");
				}
			}).keyup(function(event){
				if (event.keyCode == 13) {
					//$(this).autocomplete("search");
				}
				if (event.which == 13 && event.which == keyDownCode) {
					$("#spell").click();
				}
			}).keydown(function(event) {
				keyDownCode = event.which;
			});
		});

		/*
		 * SpellCheckComponentを使ったDid You Mean ?
		 */
		$(function(){
			$("#spell").click(function() {
				$.ajax({
					async: false,
					url: "/solr/" + collection + "/spell",
					type: "GET",
					cache: false,
					dataType: "json",
					data: {'q':$("#terms").val(), 'spellcheck.extendedResults':false, 'spellcheck.onlyMorePopular':true, wt:'json'},
					success: function(msg, textStatus){
						$("#spell_dym").html("&nbsp;");
						term = msg.spellcheck.suggestions[1].suggestion[0];
            if (term && term != $("#terms").val()) {
							$("#spell_dym").text("Did you mean ? : " + term);
						}
          },
          error: function(xhr, ts, err){
            $("#spell_dym").html("&nbsp;");
          }
        });
			});
		});

		/*
		 * Suggesterを使ったAutoComplete
		 */
		$(function(){
			$("#autocomplete_ja").autocomplete({
				search: function(event, ui){
					//if (event.keyCode == 229) return false;
					return true;
				},
				source: function(request, response){
          $.ajax({
						url: "/solr/" + collection + "/autocomplete_ja",
						type: "GET",
						cache: false,
						dataType: "json",
						data: {q:request.term, wt:'json'},
						success: function(o){
              var values = new Array();
              for(var i = 0; i < o.suggest.autocomplete_ja[request.term].suggestions.length; i++){
                values.push(o.suggest.autocomplete_ja[request.term].suggestions[i].term)
              }
              response(values);

						},
						error: function(xhr, ts, err){
              alert(err);
              response();
						}
					});
				},
				open: function() {
					$(this).removeClass("ui-corner-all");
				}
			}).keyup(function(event){
				if (event.keyCode == 13) {
					//$(this).autocomplete("search");
				}
				if (event.which == 13 && event.which == keyDownCode) {
					$("#didyoumean_ja").click();
				}
			}).keydown(function(event) {
				keyDownCode = event.which;
			});
		});

		/*
		 * Suggesterを使ったDid You Mean ?
		 */
		$(function(){
			$("#didyoumean_ja").click(function() {
				$.ajax({
					async: false,
					url: "/solr/" + collection + "/didyoumean_ja",
					type: "GET",
					cache: false,
					dataType: "json",
					data: {'q':$("#autocomplete_ja").val(), wt:'json'},
					success: function(msg, textStatus){
						$("#didyoumean_ja_dym").html("&nbsp;");
						term = msg.suggest.didyoumean_ja[$("#autocomplete_ja").val()].suggestions[0].term;
						if (term && term != $("#autocomplete_ja").val()) {
							$("#didyoumean_ja_dym").text("Did you mean ? : " + term);
						}
					},
          error: function(xhr, ts, err){
            $("#didyoumean_ja_dym").html("&nbsp;");
          }
        });
			});
		});
		//--></script>

		</head>

		<body>
		<h3>TermsComponent、SpellCheckComponentを使った自動補完、もしかして？</h1>
		<div class="query-box">
			<input style="font-size: 12pt;" class="textbox" type="text" id="terms" name="q" value="" autocomplete="off"/>
			<input class="css_btn_class" type="button" id="spell" name="search" value="Search"/>
		</div>
		<div style="font-size: 12pt;" id="spell_dym">&nbsp;</div>

		<br/>
		<br/>
		<br/>
		<br/>
		<br/>

		<h3>Suggesterを使った自動補完、もしかして？</h1>
		<div class="query-box">
			<input style="font-size: 12pt;" class="textbox" type="text" id="autocomplete_ja" name="q" value="" autocomplete="off"/>
			<input class="css_btn_class" type="button" id="didyoumean_ja" name="search" value="Search"/>
		</div>
		<div style="font-size: 12pt;" id="didyoumean_ja_dym">&nbsp;</div>

	</body>

</html>
